name: Release Build

on:
  push:
    tags:
      - 'v*'  # v1.0.0, v2.1.3 등의 태그가 푸시되면 실행

jobs:
  build:
    runs-on: windows-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v3
      
    - name: Setup .NET Framework
      uses: microsoft/setup-msbuild@v1.1
      
    - name: Restore NuGet packages
      run: nuget restore FACTOVA_Launcher.sln
      
    - name: Build Release
      run: msbuild FACTOVA_Launcher.sln /p:Configuration=Release /p:Platform="Any CPU"
    
    - name: Create GitHub Release
      uses: softprops/action-gh-release@v1
      with:
        files: |
          bin/Release/FACTOVA_Launcher.exe
          bin/Release/FACTOVA_Launcher.exe.config
          bin/Release/Newtonsoft.Json.dll
          PatchNotes.md
        body: |
          ## FACTOVA Launcher ${{ github.ref_name }}
          
          ### 다운로드 및 설치
          1. 아래 Assets에서 파일 다운로드:
             - **FACTOVA_Launcher.exe** (메인 실행 파일)
             - **FACTOVA_Launcher.exe.config** (설정 파일)
             - **Newtonsoft.Json.dll** (필수 라이브러리)
             - **PatchNotes.md** (패치노트)
          2. 모든 파일을 같은 폴더에 저장
          3. `FACTOVA_Launcher.exe` 실행
          
          ### 변경 사항
          자세한 내용은 PatchNotes.md를 참고하세요.
          
          ### 참고
          - .exe.config와 .dll 파일도 함께 다운로드해야 합니다.
          - 모든 파일이 같은 폴더에 있어야 정상 작동합니다.
        draft: false
        prerelease: false
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
